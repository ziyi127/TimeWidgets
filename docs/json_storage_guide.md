# 课表编辑器 JSON 存储功能

## 概述

课表编辑器现在支持使用JSON格式存储和管理课表数据。所有数据都会自动保存到本地存储中，并可以在应用程序启动时自动加载。

## 功能特性

1. **自动保存**: 每次修改课表数据时，应用程序会自动将数据保存为JSON格式。
2. **数据持久化**: 应用程序关闭后重新打开，数据会自动恢复。
3. **JSON数据查看器**: 可以查看、导出和导入JSON格式的课表数据。
4. **数据完整性**: 通过测试确保JSON序列化和反序列化的数据完整性。

## 数据结构

课表数据包含以下三个主要部分：

1. **课程信息 (courses)**: 包含课程ID、名称、教师、教室和颜色等信息。
2. **时间段 (timeSlots)**: 包含时间段ID、开始时间、结束时间和名称。
3. **日课表 (dailyCourses)**: 包含每日课程安排，关联课程和时间段。

## 使用方法

### 查看JSON数据

1. 打开课表编辑器
2. 点击顶部工具栏中的代码图标 (`</>`)
3. 在JSON数据查看器中，您可以：
   - 查看数据概览（课程、时间段和日课表的数量）
   - 查看完整的JSON数据
   - 复制JSON数据到剪贴板

### 导出JSON数据

1. 在JSON数据查看器中，点击导出按钮（下载图标）
2. JSON数据将被复制到剪贴板
3. 您可以将数据粘贴到文本编辑器或文件中

### 导入JSON数据

1. 复制有效的JSON课表数据到剪贴板
2. 在JSON数据查看器中，点击导入按钮（上传图标）
3. 应用程序将验证并导入数据

## JSON数据格式示例

```json
{
  "courses": [
    {
      "id": "1",
      "name": "语文",
      "teacher": "张老师",
      "classroom": "101",
      "color": "#2196F3"
    }
  ],
  "timeSlots": [
    {
      "id": "1",
      "startTime": "08:00",
      "endTime": "08:45",
      "name": "早读"
    }
  ],
  "dailyCourses": [
    {
      "id": "1",
      "dayOfWeek": 0,
      "timeSlotId": "1",
      "courseId": "1",
      "weekType": 2
    }
  ]
}
```

## 注意事项

1. **数据备份**: 建议定期导出JSON数据作为备份。
2. **数据格式**: 导入JSON数据时，请确保格式正确，否则可能导致导入失败。
3. **数据覆盖**: 导入JSON数据将完全替换当前数据，请谨慎操作。
4. **枚举值**: 
   - `dayOfWeek`: 0-6 分别表示周一到周日
   - `weekType`: 0-2 分别表示单周、双周和每周

## 技术实现

- **存储位置**: 应用程序文档目录下的 `timetable_data.json` 文件
- **序列化**: 使用Dart内置的`jsonEncode`和`jsonDecode`方法
- **自动保存**: 每次数据修改时触发自动保存
- **错误处理**: 包含完善的错误处理和用户提示

## 测试

应用程序包含完整的单元测试，确保JSON序列化和反序列化的正确性。运行以下命令执行测试：

```bash
flutter test test/json_storage_test.dart
```